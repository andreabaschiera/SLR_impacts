MER_values <- conversion_gdpuc(
diva,
variables_toconvert,
from = "constant 2011 Int$PPP",
to = "constant 2017 US$MER",
abbreviations,
loc = "locationid",
time = "time"
)
# merging with gdp per capita values from SSPs
MER_values <- MER_values |>
left_join(gdpc |> select(locationid, time, computed_gdpc) |> rename(gdpc_MER2017 = computed_gdpc),
join_by(locationid == locationid, time))
gdpc
MER_values <- MER_values |>
left_join(gdpc |> select(locationid, time, computed_gdpc) |> rename(gdpc_MER2017 = computed_gdpc),
join_by(locationid == ISO, time))
MER_values
MER_values <- MER_values |>
left_join(gdpc |> select(ISO, time, computed_gdpc) |> rename(gdpc_MER2017 = computed_gdpc),
join_by(locationid == ISO, time))
MER_values <- MER_values |> relocate(totalpop, .after = gdpc_MER2017) |>
rename(ead_PPP2011=expected_annual_damages,dike_inv_PPP2011=sea_dike_cost_investment,mant_PPP2011=sea_dike_cost_maintenance) |>
arrange(rcp, quantile, adaptation, time, locationid) |>
mutate(total_assets = gdpc_MER2017 * totalpop * 2.8) #computing total assets
saveRDS(MER_values,"outputs/capital/Ead_dikeinv_dike_maint_gdpc_MER2017_ISO.rds")
write_xlsx(MER_values, "outputs/capital/Ead_dikeinv_dike_maint_gdpc_MER2017_ISO.xlsx")
# INTERPOLATION -----------------------------------------------------------
sel <- MER_values |> select(locationid:time,ead_MER2017,total_assets) |>
arrange(rcp,quantile,adaptation,locationid,time)
alltimes <- seq(2015, 2100, by = 1)
time <- unique(sel$time)
groupby_vars <- c("locationid", "rcp", "quantile", "adaptation")
interp_vars <- c("ead_MER2017", "total_assets")
# linear interpolation
k_interpolated <- lin_interp_ongroups(sel, time, alltimes, groupby_vars, interp_vars)
# RECALCULATIONS locationid ------------------------------------------------------
# annual capital growth rate and growth factor
k_shock_growth_ISO <- growthRate_growthFactor(k_interpolated,
time, 2015,
groupby_vars,
ead_MER2017_timely,
total_assets_timely)
k_shock_growth_ISO
k_interpolated
sel
k_interpolated
# annual capital growth rate and growth factor
k_shock_growth_ISO <- growthRate_growthFactor(k_interpolated,
time, 2015,
groupby_vars,
ead_MER2017_yearly,
total_assets_yearly)
# 5 times cumulative shocks for locationid
k_shock_5y_ISO <- cum_shocks_5y(k_shock_growth_ISO, time, 2018, groupby_vars, growth_factor)
k_shock_5y_ISO_wide <- k_shock_5y_ISO |>
select(-cumulated_growth) |>
pivot_wider(names_from = time, values_from = cumulated_shock)
# cumulated shock over 50 times (2020-2070)
k_shock_cum_ISO <- cum_shock_manytimes(k_shock_growth_ISO, 2018, 2070, time, groupby_vars, growth_factor)
# cumulated shock over 50 times (2020-2070)
k_shock_cum_ISO <- cum_shock_manyyears(k_shock_growth_ISO, 2018, 2070, time, groupby_vars, growth_factor)
saveRDS(k_shock_5y_ISO_wide, "outputs/capital/k_shock_SLR_5y_ISO.rds")
write_xlsx(k_shock_5y_ISO_wide, "outputs/capital/k_shock_SLR_5y_ISO.xlsx")
saveRDS(k_shock_cum_ISO, "outputs/capital/k_shock_cum_ISO.rds")
write_xlsx(k_shock_cum_ISO, "outputs/capital/k_shock_SLR_cum_ISO.xlsx")
# RECALCULATIONS ACCREU ICES MH -------------------------------------------
# merging with mapping
interp_ICES_MH <- agg_ICES_MH |> left_join(k_interpolated, join_by(ISO == locationid))
EAD_ASSET_ICES_MH <- interp_ICES_MH |>
group_by(across(starts_with("ICES_ACCREU")), rcp, quantile, adaptation, time) |>
summarise(across(c(ead_MER2017_timely, total_assets_timely), ~ sum(.x, na.rm = TRUE)),
.groups = "drop")
EAD_ASSET_ICES_MH <- interp_ICES_MH |>
group_by(across(starts_with("ICES_ACCREU")), rcp, quantile, adaptation, time) |>
summarise(across(c(ead_MER2017_yearly, total_assets_yearly), ~ sum(.x, na.rm = TRUE)),
.groups = "drop")
# annual capital growth
groupby_varsMH <- c(groupby_vars[2:4], "ICES_ACCREU", "ICES_ACCREU_long", "ICES_ACCREU_n")
k_shock_growth_ICES_MH <- growthRate_growthFactor(EAD_ASSET_ICES_MH,
time, 2015,
groupby_varsMH,
ead_MER2017_yearly,
total_assets_yearly)
# 5 times cumulative shocks
k_shock_5y_ICES_MH <- cum_shocks_5y(k_shock_growth_ICES_MH, time, 2018, groupby_varsMH, growth_factor)
k_shock_5y_ICES_MH_wide <- k_shock_5y_ICES_MH |>
select(-cumulated_growth) |>
pivot_wider(names_from = time, values_from = cumulated_shock)
# cumulated 50-times shock
k_shock_cum_ICES_MH <- cum_shock_manyyears(k_shock_growth_ICES_MH, 2018, 2070, time, groupby_varsMH, growth_factor)
# Saving outputs (also, CSVs disaggregated by scenario and adaptation option)
saveRDS(k_shock_5y_ICES_MH_wide, "outputs/capital/k_shock_5y_ICES_MH.rds")
write_xlsx(k_shock_5y_ICES_MH_wide, "outputs/capital/k_shock_5y_ICES_MH.xlsx")
rcp_uniques <- unique(k_shock_5y_ICES_MH_wide$rcp)
adapt_uniques <- unique(k_shock_5y_ICES_MH_wide$adaptation)
quantile_uniques <- unique(k_shock_5y_ICES_MH_wide$quantile)
saving_disagg(k_shock_5y_ICES_MH_wide, "k_shock_5y_ICES_MH_",
rcp_uniques, adapt_uniques, quantile_uniques,
additional_cols_todrop = c("ICES_ACCREU_long", "ICES_ACCREU_n"),
path = "outputs/capital")
write_xlsx(k_shock_cum_ICES_MH, "outputs/capital/k_shock_cum_ICES_MH.xlsx")
# RECALCULATIONS ACCREU ICES REG ------------------------------------------
agg_ICES_REG_nonNUTS <- agg_ICES_REG |> filter(Filter_NUTS == 1)
# merging with mapping and building whole ds
interp_ICES_REG <-  agg_ICES_REG_nonNUTS |> left_join(k_interpolated, join_by(ISO == locationid))
landlock_countries <- anti_join(agg_ICES_REG_nonNUTS, k_interpolated, join_by(ISO == locationid))
landlock_complete <- crossjoin_tobind(landlock_countries, interp_ICES_REG,
cols_structure = c("rcp", "quantile", "adaptation", "time"),
cols_values = c("ead_MER2017_yearly", "total_assets_yearly"))
interp_ICES_REG_all <- bind_rows(interp_ICES_REG, landlock_complete)
EAD_ASSET_ICES_REG <- interp_ICES_REG_all |>
group_by(across(starts_with("ICES_ACCREU")), rcp, quantile, adaptation, time) |>
summarise(across(c(ead_MER2017_yearly, total_assets_yearly), ~ sum(.x, na.rm = TRUE)), .groups = "drop")
# annual capital growth
groupby_varsREG <- c(groupby_vars[2:4],
"ICES_ACCREU_REG","ICES_ACCREU_REG_long","ICES_ACCREU_REG_n","ICES_ACCREU_AGG")
k_shock_growth_ICES_REG <- growthRate_growthFactor(EAD_ASSET_ICES_REG,
time, 2015,
groupby_varsREG,
ead_MER2017_yearly,
total_assets_yearly)
# 5 times cumulative shocks (for GTAP)
k_shock_5y_ICES_REG <- cum_shocks_5y(k_shock_growth_ICES_REG, time, 2018, groupby_varsREG, growth_factor)
k_shock_5y_ICES_REG_wide <- k_shock_5y_ICES_REG |>
select(-cumulated_growth) |>
pivot_wider(names_from = time, values_from = cumulated_shock)
# cumulated 50-times shock
k_shock_cum_ICES_REG <- cum_shock_manyyears(k_shock_growth_ICES_REG, 2018, 2070, time, groupby_varsREG, growth_factor)
# Saving outputs
saveRDS(k_shock_5y_ICES_REG_wide, "outputs/capital/k_shock_5y_ICES_REG.rds")
write_xlsx(k_shock_5y_ICES_REG_wide, "outputs/capital/k_shock_5y_ICES_REG.xlsx")
write_xlsx(k_shock_cum_ICES_REG, "outputs/capital/k_shock_cum_ICES_REG.xlsx")
# Maps results ------------------------------------------------------------
# geometry data
world <- tibble(ne_countries(scale = "medium", returnclass = "sf")) |> rename(locationid = iso_a3) |>
mutate(locationid = if_else(iso_a3_eh %in% c("FRA", "NOR"), iso_a3_eh, locationid)) |>
select(locationid, geometry) |> filter(locationid != -99)
ead_world <- full_join(k_shock_growth_ISO, world, join_by(locationid))
ead_cum_world <- full_join(k_shock_cum_ISO, world, join_by(locationid))
#per ead_world
missing <- ead_world |> filter(is.na(time)) |> distinct(locationid)
missing <- as.character(missing[[1]])
structure <- k_shock_growth_ISO |> distinct(rcp,quantile,adaptation,time)
compile_for_missing <- expand_grid(locationid = missing,structure)
missing_geom <- ead_world |> filter(locationid %in% missing) |> select(locationid,geometry)
missing_rows <- left_join(compile_for_missing, missing_geom, join_by(locationid))
a <- colnames(ead_world)
b <- colnames(missing_rows)
columns <- setdiff(a,b)
missing_rows[,columns] <- NA
missing_rows <- missing_rows |> relocate(geometry,.after = last_col())
#attaching (all this to have a complete map with missing countries displayed)
ead_all <- bind_rows(ead_world,missing_rows)
ead_all <- ead_all |> filter(!is.na(rcp)) # eliminating redundant lines
ead_all
ead_missing |> anti_join(k_shock_growth_ISO, world)
ead_missing <- anti_join(k_shock_growth_ISO, world)
ead_missing
ead_missing <- anti_join(world, k_shock_growth_ISO, join_by(locationid))
ead_missing
ead_world
colnames(ead_world |> select(rcp:time))
structure <- colnames(ead_world |> select(rcp:time))
tail(names(k_shock_growth_ISO), 5)
cols_values <- tail(names(k_shock_growth_ISO), 5)
structure <- colnames(ead_world |> select(rcp:time))
crossjoin_tobind(ead_missing, ead_world, structure, cols_values, NA)
# "ead": expected annual damages
ead <- full_join(k_shock_growth_ISO, world, join_by(locationid))
ead_cum <- full_join(k_shock_cum_ISO, world, join_by(locationid))
ead_missing <- anti_join(world, k_shock_growth_ISO, join_by(locationid))
structure <- colnames(ead_world |> select(rcp:time))
cols_values <- tail(names(k_shock_growth_ISO), 5)
ead_world <- bind_rows(ead, crossjoin_tobind(ead_missing, ead_world, structure, cols_values, NA))
ead_world
ead_all
ead_world |> filter(!is.na(rcp))
ead_world |> filter(is.na(rcp))
k_shock_growth_ISO |> filter(is.na(rcp))
ead_world |> filter(is.na(rcp)) |> distinct(locationid)
ead_missing
ead
# "ead": expected annual damages
ead <- left_join(k_shock_growth_ISO, world, join_by(locationid))
ead
ead_world <- bind_rows(ead, crossjoin_tobind(ead_missing, ead_world, structure, cols_values, NA))
ead_world
ead_all
ead_world |> count(locationid)
ead_world |> count(locationid) |> filter(n<2322)
ead_world |> count(locationid) |> filter(n>2322)
length(ead_world)
ead_missing
View(ead_missing)
crossjoin_tobind(ead_missing, ead_world, structure, cols_values, NA)
missing_rows
ead <- left_join(k_shock_growth_ISO, world, join_by(locationid))
ead_cum <- full_join(k_shock_cum_ISO, world, join_by(locationid))
ead_missing <- anti_join(world, k_shock_growth_ISO, join_by(locationid))
structure <- colnames(ead_world |> select(rcp:time))
cols_values <- tail(names(k_shock_growth_ISO), 5)
ead_world <- bind_rows(ead, crossjoin_tobind(ead_missing, ead, structure, cols_values, NA))
ead_world
k_shock_cum_ISO
allcountries <- tibble(locationid = world$locationid) |> filter(locationid != -99)
structure2 <- structure |> select(!time) |> distinct(rcp,quantile,adaptation)
structure
structure2 <- k_shock_cum_ISO |> distinct(rcp,quantile,adaptation)
data_in <- cross_join(structure2,allcountries)
data_without_poly <- left_join(data_in,k_shock_cum_ISO, by=c("rcp","quantile","adaptation","locationid"))
geoms <- world |> select(locationid,geometry) |> rename(locationid = locationid)
data_cum <- inner_join(data_without_poly, geoms, by="locationid")
data_cum
data_cum |> distinct(locationid)
ead_world |> distinct(locationid)
ead_cum
# cumulative values (2017-2070)
structure2 <- colnames(ead_cum |> select(rcp:adaptation))
cols_values2 <- tail(names(k_shock_cum_ISO), 2)
cols_values2
ead_cum_world <- bind_rows(ead_cum, crossjoin_tobind(ead_missing, ead_cum, structure2, cols_values2, NA))
View(ead_cum_world)
ead_cum_world
data_cum
ead_cum_world |> count(locationid)
ead_cum_world |> count(locationid) |> filter(n>27)
ead_cum <- left_join(k_shock_cum_ISO, world, join_by(locationid))
ead_cum_world <- bind_rows(ead_cum, crossjoin_tobind(ead_missing, ead_cum, structure2, cols_values2, NA))
ead_cum_world
?st_as_sf
?range
range(- map_cum$cumulated_shock, na.rm = TRUE)
# map of the cumulated shocks (2018-2070)
map_cum <- sf::st_as_sf(ead_cum_world |> filter(rcp == '370',
quantile == '0.5',
adaptation == "Constant dike height"))
range(- map_cum$cumulated_shock, na.rm = TRUE)
ead_cum_world
ead_cum_world |> filter(cumulated_shock > 100)
ead_cum_world |> filter(cumulated_shock > 90)
ead_cum_world |> filter(cumulated_shock > 80)
ead_cum_world |> filter(cumulated_shock < -80)
View(cum_shock_manyyears)
range(- map_cum$cumulated_shock)
range(- map_cum$cumulated_shock, na.rm = TRUE)
map_cum |>
ggplot()
colours = c("lightyellow", "khaki1", "gold", "orange", "orangered2", "red3", "purple4")
colours
?rescale
rescale(1:100)
scales::rescale(c(min(range_data), 2, 5, 10, 20, 40, max(range_data)), to = c(0, 1), from = range_data)
range_data <- range(-map_cum$cumulated_shock, na.rm = TRUE)
values = scales::rescale(c(min(range_data), 2, 5, 10, 20, 40, max(range_data)), to = c(0, 1), from = range_data)
values
map_cum |>
ggplot() +
geom_sf(aes(fill = -cumulated_shock)) +
scale_fill_gradientn(
colours = c("lightyellow", "khaki1", "gold", "orange", "orangered2", "red3", "purple4"),
values = scales::rescale(c(min(range_data), 2, 5, 10, 20, 40, max(range_data)), to = c(0, 1), from = range_data),
limits = range_data,
na.value = "lightgrey"
) +
theme_light()+
labs(fill = "Cum shock (%)",
title = "World map of sea level rise impacts",
subtitle = "Cumulated damages 2020-2070 (in percentage)",
caption = "Data relaborated from the DIVA model")
# map of the cumulated shocks (2018-2070)
map_cum <- sf::st_as_sf(ead_cum_world |> filter(
locationid != "NLD",
rcp == '370',
quantile == '0.5',
adaptation == "Constant dike height"))
range_data <- range(-map_cum$cumulated_shock, na.rm = TRUE)
map_cum |>
ggplot() +
geom_sf(aes(fill = -cumulated_shock)) +
scale_fill_gradientn(
colours = c("lightyellow", "khaki1", "gold", "orange", "orangered2", "red3", "purple4"),
values = scales::rescale(c(min(range_data), 2, 5, 10, 20, 40, max(range_data)), to = c(0, 1), from = range_data),
limits = range_data,
na.value = "lightgrey"
) +
theme_light()+
labs(fill = "Cum shock (%)",
title = "World map of sea level rise impacts",
subtitle = "Cumulated damages 2020-2070 (in percentage)",
caption = "Data relaborated from the DIVA model")
#data for the Netherlands are incredibly high, so I rescale them for visualisation purposes
ead_cum_world |> filter(cumulated_shock < -100)
#data for the Netherlands are incredibly high, so I rescale them for visualisation purposes
ead_cum_world |>
mutate(cumulated_shock = ifelse(cumulated_shock < -100, -100, cumulated_shock)) |>
filter(cumulated_shock < -100)
#data for the Netherlands are incredibly high, so I rescale them for visualisation purposes
ead_cum_world_revisited <- ead_cum_world |>
mutate(cumulated_shock = ifelse(cumulated_shock < -100, -100, cumulated_shock))
scales::rescale(c(min(range_data), 2, 5, 10, 20, 40, max(range_data)), to = c(0, 1), from = range_data
)
range_data
scales::rescale(c(0, 2, 5, 10, 20, 40, 100), to = c(0, 1), from = range_data
)
rescale(c(0, 2, 5, 10, 20, 40, 100), to = c(0, 1), from = c(0, 100))
values = rescale(c(0, 2, 5, 10, 20, 40, 100), to = c(0, 1), from = c(0, 100))
values
ggplot(map_cum) +
geom_sf(aes(fill = -cumulated_shock)) +
scale_fill_gradientn(colours, values, limits = c(0,100), na.value = "lightgrey") +
# theme_light() +
labs(fill = "Cum shock (%)",
title = "World map of sea level rise impacts",
subtitle = "Cumulated damages 2018-2070 (percentages)",
caption = "Data relaborated from DIVA model")
?scale_fill_gradientn
ggplot(map_cum) +
geom_sf(aes(fill = -cumulated_shock)) +
scale_fill_gradientn(colours = colours, values = values, limits = c(0,100), na.value = "lightgrey") +
# theme_light() +
labs(fill = "Cum shock (%)",
title = "World map of sea level rise impacts",
subtitle = "Cumulated damages 2018-2070 (percentages)",
caption = "Data relaborated from DIVA model")
ggplot(map_cum) +
geom_sf(aes(fill = -cumulated_shock)) +
scale_fill_gradientn(colours = colours, values = values, limits = c(0,100), na.value = "lightgrey") +
theme_light() +
labs(fill = "Cum shock (%)",
title = "World map of sea level rise impacts",
subtitle = "Cumulated damages 2018-2070 (percentages)",
caption = "Data relaborated from DIVA model")
?ggsave
ggsave(path ="outputs/capital/maps/assets_shock_RCP370_p05.png", width = 8, height = 6)
ggsave(filename = "assets_shock_RCP370_p05.png", path = "outputs/capital/maps", width = 8, height = 6)
ggsave(filename = "assets_shock_RCP370_p05.png", path = "outputs/capital/maps") #width = 8, height = 6)
for (rcp in (ead |> distinct(rcp)){
for (rcp in (ead |> distinct(rcp))){
print(rcp)
}
for (rcp in unique(ead$rcp))){
for (rcp in unique(ead$rcp)){
print(rcp)
}
for (rcp in unique(ead_cum$rcp)){
map_cum <- sf::st_as_sf(ead_cum_world_revisited |> filter(
rcp == rcp,
quantile == '0.5',
adaptation == "Constant dike height"))
ggplot(map_cum) +
geom_sf(aes(fill = -cumulated_shock)) +
scale_fill_gradientn(colours = colours, values = values, limits = c(0,100), na.value = "lightgrey") +
theme_light() +
labs(fill = "Cum shock (%)",
title = "World map of sea level rise impacts",
subtitle = paste0("Cumulated damages (in %) 2018-2070, RCP scenario: ",rcp),
caption = "Data relaborated from DIVA model")
ggsave(filename = paste0("assets_shock_RCP",rcp,"_p05.png"), path = "outputs/capital/maps")
}
?assign
map_cum <- sf::st_as_sf(ead_cum_world_revisited |> filter(
rcp == '126',
quantile == '0.5',
adaptation == "Constant dike height"))
ggplot(map_cum) +
geom_sf(aes(fill = -cumulated_shock)) +
scale_fill_gradientn(colours = colours, values = values, limits = c(0,100), na.value = "lightgrey") +
theme_light() +
labs(fill = "Cum shock (%)",
title = "World map of sea level rise impacts",
subtitle = "Cumulated damages 2018-2070 (percentages)",
caption = "Data relaborated from DIVA model")
map_cum <- sf::st_as_sf(ead_cum_world_revisited |> filter(
rcp == '126',
quantile == '0.05',
adaptation == "Constant dike height"))
ggplot(map_cum) +
geom_sf(aes(fill = -cumulated_shock)) +
scale_fill_gradientn(colours = colours, values = values, limits = c(0,100), na.value = "lightgrey") +
theme_light() +
labs(fill = "Cum shock (%)",
title = "World map of sea level rise impacts",
subtitle = "Cumulated damages 2018-2070 (percentages)",
caption = "Data relaborated from DIVA model")
map_cum <- sf::st_as_sf(ead_cum_world_revisited |> filter(
rcp == '370',
quantile == '0.5',
adaptation == "Constant"))
View(ead_cum_world)
map_cum <- sf::st_as_sf(ead_cum_world_revisited |> filter(
rcp == '370',
quantile == '0.5',
adaptation == "Constant flood protection standards"))
ggplot(map_cum) +
geom_sf(aes(fill = -cumulated_shock)) +
scale_fill_gradientn(colours = colours, values = values, limits = c(0,100), na.value = "lightgrey") +
theme_light() +
labs(fill = "Cum shock (%)",
title = "World map of sea level rise impacts",
subtitle = "Cumulated damages 2018-2070 (percentages)",
caption = "Data relaborated from DIVA model")
map_cum <- sf::st_as_sf(ead_cum_world_revisited |> filter(
rcp == '370',
quantile == '0.5',
adaptation == "Optimal protection"))
ggplot(map_cum) +
geom_sf(aes(fill = -cumulated_shock)) +
scale_fill_gradientn(colours = colours, values = values, limits = c(0,100), na.value = "lightgrey") +
theme_light() +
labs(fill = "Cum shock (%)",
title = "World map of sea level rise impacts",
subtitle = "Cumulated damages 2018-2070 (percentages)",
caption = "Data relaborated from DIVA model")
plots <- []
plots <- list()
plots
print(index(rcp))
print(rcp)
for (rcp in unique(ead$rcp)){
print(rcp)
}
unique(ead$rcp)
unique(ead$rcp) == 245
where(unique(ead$rcp) == 245)
which(unique(ead$rcp) == 245)
for (rcp in unique(ead$rcp)){
print(which(unique(ead$rcp) == rcp))
}
for (rcp in unique(ead_cum$rcp)){
map_cum <- sf::st_as_sf(ead_cum_world_revisited |> filter(
rcp == rcp,
quantile == '0.5',
adaptation == "Constant dike height"))
plots[which(unique(ead$rcp) == rcp)] <- ggplot(map_cum) +
geom_sf(aes(fill = -cumulated_shock)) +
scale_fill_gradientn(colours = colours, values = values, limits = c(0,100), na.value = "lightgrey") +
theme_light() +
labs(fill = "Ciao", #Cum shock (%)
title = "World map of sea level rise impacts",
subtitle = paste0("Cumulated damages 2018-2070 (in %), RCP scenario: ",rcp),
caption = "Data relaborated from DIVA model")
ggsave(filename = paste0("assets_shock_RCP",rcp,"_p05.png"), path = "outputs/capital/maps")
}
plot_world_cum <- function(ds_map_cum, colours, values, rcp, quantile, adaptation){
ggplot(map_cum) +
geom_sf(aes(fill = -cumulated_shock)) +
scale_fill_gradientn(colours = colours, values = values, limits = c(0,100), na.value = "lightgrey") +
theme_light() +
labs(fill = "Cum shock (%)",
title = "World map of sea level rise impacts",
subtitle = paste0("Cumulated damages 2018-2070 (in %), RCP: ",rcp, " / quantile: ", quantile, " / adaptation opt: ", adaptation),
caption = "Data relaborated from DIVA model")
}
source("scripts/functions/plots")
source("scripts/functions/plots")
source("scripts/functions/plots.R")
plot_world_cum <- function(ds_map_cum, rcp, quantile, adaptation){
ggplot(map_cum) +
geom_sf(aes(fill = -cumulated_shock)) +
scale_fill_gradientn(colours = c("lightyellow", "khaki1", "gold", "orange", "orangered2", "red3", "purple4"),
values = rescale(c(0, 2, 5, 10, 20, 40, 100), to = c(0, 1), from = c(0, 100)),
limits = c(0,100), na.value = "lightgrey") +
theme_light() +
labs(fill = "Cum shock (%)",
title = "World map of sea level rise impacts",
subtitle = paste0("Cumulated damages 2018-2070 (in %), RCP: ",rcp, " / quantile: ", quantile, " / adaptation opt: ", adaptation),
caption = "Data relaborated from DIVA model")
}
#     scale_fill_gradientn(colours = colours, values = values, limits = c(0,100), na.value = "lightgrey") +
#     theme_light() +
#     labs(fill = "Ciao", #Cum shock (%)
#          title = "World map of sea level rise impacts",
#          subtitle = paste0("Cumulated damages 2018-2070 (in %), RCP scenario: ",rcp),
#          caption = "Data relaborated from DIVA model")
#
#   ggsave(filename = paste0("assets_shock_RCP",rcp,"_p05.png"), path = "outputs/capital/maps")
#
# }
map_cum <- sf::st_as_sf(ead_cum_world_revisited |> filter(
rcp == '245',
quantile == '0.5',
adaptation == "Constant dike height"))
# maps of the cumulated shocks (2018-2070)
plot_world_cum(map_cum, rcp = "245", quantile = "0.5", adaptation = "Constant")
?labs
plot_world_cum <- function(ds_map_cum, rcp, quantile, adaptation){
ggplot(map_cum) +
geom_sf(aes(fill = -cumulated_shock)) +
scale_fill_gradientn(colours = c("lightyellow", "khaki1", "gold", "orange", "orangered2", "red3", "purple4"),
values = rescale(c(0, 2, 5, 10, 20, 40, 100), to = c(0, 1), from = c(0, 100)),
limits = c(0,100), na.value = "lightgrey") +
theme_light() +
labs(fill = "Cum shock (%)",
title = "Sea level rise impacts (cumulated damages 2018-2070, in %)",
subtitle = paste0("RCP scenario: ",rcp, " / Quantile: ", quantile, " / Adaptation Opt: ", adaptation),
caption = "Data relaborated from DIVA model")
}
# maps of the cumulated shocks (2018-2070)
plot_world_cum(map_cum, rcp = "245", quantile = "0.5", adaptation = "Constant")
ead_cum_world
# maps of the cumulated shocks (2018-2070)
plot_world_cum(map_cum, rcp = 245, quantile = 0.5, adaptation = "Constant")
find -name "DESCRIPTION"
find -name "DESCRIPTION"
install.packages("learnr")
getwd()
getwd()
setwd("C:/Users/154525)
setwd("C:/Users/154525")
gc()
getwd()
